# Security Measures: 
## A Cost-Benefit Analysis and Motivation for Implementation
In this document, we will review the warnings generated by the Slither tool and discuss the motivation behind them. We will also discuss why these warnings have not been modified. By examining the potential impact of these warnings, we will provide an overview of our decision-making process and the considerations that went into it.
## Reentrancy

> in [FanToArtistStaking.redeem](./contracts/FanToArtistStaking.sol).redeem(address,uint128) (contracts/FanToArtistStaking.sol#236-256):
> 
>   External calls:
>   - _jtp.unlock(_msgSender(),_stake[artist][_msgSender()][uint256(index)].amount) (contracts/FanToArtistStaking.sol#251-254)
> 
>   State variables written after the call(s):
>   - _stake[artist][_msgSender()][uint256(index)].redeemed = true (contracts/FanToArtistStaking.sol#255)


> in [FanToArtistStaking.stake](./contracts/FanToArtistStaking.sol).stake(address,uint256,uint128) (contracts/FanToArtistStaking.sol#207-234):
> 
>   External calls:
>   - _jtp.lock(_msgSender(),amount) (contracts/FanToArtistStaking.sol#225)
> 
>   State variables written after the call(s):
>   - _addStake(_msgSender(),artist,end,amount,isStaking) (contracts/FanToArtistStaking.sol#226)
>       - _artistStaked[sender].push(artist) (contracts/FanToArtistStaking.sol#115)
>   - _addStake(_msgSender(),artist,end,amount,isStaking) (contracts/FanToArtistStaking.sol#226)
>       - _stake[artist][sender].push(Stake(amount,uint128(block.timestamp),uint128(block.timestamp) + end,_veJTPRewardRate,_artistJTPRewardRate,false)) (contracts/FanToArtistStaking.sol#117-126)

These warnings refer to [this](https://github.com/crytic/slither/wiki/Detector-Documentation#reentrancy-vulnerabilities-1) exact type of attack. The [JTP](./contracts/JTP.sol) contract, being written by us and being callback-free, we are sure that it doesnt have callback that point to our contract.

> in [JTPManagement.burn](./contracts/JTPManagement.sol)(uint256) (contracts/JTPManagement.sol#50-53):
> 
> External calls:
>    - _JTP.burn(amount) (contracts/JTPManagement.sol#51)
> 
> Event emitted after the call(s):
>    - Burn(address(this),amount,_msgSender()) (contracts/JTPManagement.sol#52)

> in [JTPManagement.burnFrom](./contracts/JTPManagement.sol)(address,uint256) (contracts/JTPManagement.sol#55-61):
> 
> External calls:
>    - _JTP.burnFrom(account,amount) (contracts/JTPManagement.sol#59)
> 
> Event emitted after the call(s):
>    - Burn(account,amount,_msgSender()) (contracts/JTPManagement.sol#60)

> in [JTPManagement.mint](./contracts/JTPManagement.sol)(address,uint256) (contracts/JTPManagement.sol#44-47):
> 
>    External calls:
>    - _JTP.mint(to,amount) (contracts/JTPManagement.sol#45)
> 
>   Event emitted after the call(s):
>    - Mint(to,amount,_msgSender()) (contracts/JTPManagement.sol#46)

> in [FanToArtistStaking.stake](./contracts/FanToArtistStaking.sol)(address,uint256,uint128) (contracts/FanToArtistStaking.sol#118-126):
> 
>    External calls:
>    - _jtp.lock(_msgSender(),amount) (contracts/FanToArtistStaking.sol#124)
> 
>    Event emitted after the call(s):
>    - ArtistStaked(artist,_msgSender(),amount,end) (contracts/FanToArtistStaking.sol#125)

These warnings refer to [this](https://github.com/crytic/slither/wiki/Detector-Documentation#reentrancy-vulnerabilities-3) exact type of attack. The [JTP](./contracts/JTP.sol) contract, being written by us and being callback-free, we are sure that it will not create inconsistencies in event generation.

## Timestamp
> [FanToArtistStaking._isStakingNow](./contracts/FanToArtistStaking.sol)(address,address) (contracts/FanToArtistStaking.sol#97-105) uses timestamp for comparisons
> 
>   Dangerous comparisons:
>   - _stake[artist][sender][i].end > block.timestamp (contracts/FanToArtistStaking.sol#102)

> [FanToArtistStaking.redeem](./contracts/FanToArtistStaking.sol)(address,uint128) (contracts/FanToArtistStaking.sol#236-256) uses timestamp for comparisons
>   Dangerous comparisons:
>   - require(bool,string)(end < block.timestamp,FanToArtistStaking: you are trying to redeem a stake before his end) (contracts/FanToArtistStaking.sol#237-240)

These warnings refer to [this](https://github.com/crytic/slither/wiki/Detector-Documentation#block-timestamp) criticity. Since we do not use it to generate a random number, and after the merge the chances of manipulating the timestamp is decreased and in any case should not exceed one minute ahead of the actual time of block mining, we decided to keep it instead
## Different versions of Solidity are used
We are using two differents solidity version, the 0.8.0 (openzeppelin) and 0.8.16 for our contracts, which is the latest and most secure for deployment according to [Slither](https://github.com/crytic/slither/wiki/Detector-Documentation#incorrect-versions-of-solidity). Keeping the compiler at version 0.8.0 means having false positive warnings when compiling. 

## Others
Some warnings appear in the contract [FanToArtistStaking](./contracts/FanToArtistStaking.sol)  which is being developed
The remaining ones comes from the @openzeppelin module which can be excluded running slither with this flag `--filter-paths "/TP/node_modules/@openzeppelin/"`